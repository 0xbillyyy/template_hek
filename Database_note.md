# Database l√† g√¨?
> Ch∆∞∆°ng tr√¨nh ƒë·ªôc l·∫≠p d√πng ƒë·ªÉ qu·∫£n l√Ω d·ªØ li·ªáu (‚Äúqu·∫£n l√Ω‚Äù ·ªü ƒë√¢y bao g·ªìm vi·ªác  l∆∞u tr·ªØ + truy c·∫≠p) üëâ d·ªØ li·ªáu ƒë∆∞·ª£c t·ªï ch·ª©c theo 1 ki·∫øn tr√∫c nh·∫•t ƒë·ªãnh. 

M·ªói OS l·∫°i c√≥ ki·∫øn tr√∫c qu·∫£n l√Ω c∆° s·ªü d·ªØ li·ªáu ri√™ng:       
+ Window: NTFS, Fat32      
+ Mac: Btrfs      
+ Linux: Ext

ƒê√≥ l√† c√°ch h·ªá ƒëi·ªÅu h√†nh qu·∫£n l√Ω file tr√™n h·ªá th·ªëng.
## T·∫°i sao l·∫°i c·∫ßn ƒë·∫øn Database management system? 
C√°c c√°ch qu·∫£n l√Ω file n√™u tr√™n ch·ªâ ph·ª•c v·ª• m·ª•c ƒë√≠ch cho m·ªôt ng∆∞·ªùi d√πng tr√™n m·ªôt m√°y t√≠nh c√° nh√¢n, n√≥ s·∫Ω kh√¥ng ph√π h·ª£p v·ªõi b√†i to√°n d·ªØ li·ªáu l·ªõn, khi m√† m√°y t√≠nh ƒë√≥ ƒë√≥ng vai tr√≤ l√† Server, ph·ª•c v·ª• cho nhi·ªÅu ng∆∞·ªùi d√πng üëâ ch·ªâ m·ªói h·ªá th·ªëng qu·∫£n l√Ω file c·ªßa h·ªá ƒëi·ªÅu h√†nh l√† kh√¥ng ƒë·ªß.
N√™n ƒë·ªëi v·ªõi b√†i to√°n Big data ch√∫ng ta s·∫Ω ph·∫£i c·∫ßn ƒë·∫øn h·ªá th·ªëng qu·∫£n l√Ω d·ªØ li·ªáu ri√™ng g·ªçi l√† **Database management system** *(v·ªõi c√°c ch·ª©c nƒÉng th√™m, xo√° , s·ª≠a d·ªØ li·ªáu)*
## Ph√¢n lo·∫°i database
+ Relational DB: c∆° s·ªü d·ªØ li·ªáu quan h·ªá

> C√°c d·ªØ li·ªáu c√≥ mqh ch·∫∑t ch·∫Ω v·ªõi nhau. Hay c√≥ th·ªÉ hi·ªÉu l√† c√°c d·ªØ li·ªáu s·∫Ω ƒë∆∞·ª£c t·ªï ch·ª©c th√†nh c√°c h√†ng, c·ªôt (d·∫°ng b·∫£ng). *V√≠ d·ª•: MySQL, PostgreSQL, SQLite* 

+ Non-relational DB: c∆° s·ªü d·ªØ li·ªáu phi quan h·ªá

> C√°c d·ªØ li·ªáu ƒë∆∞·ª£c t·ªï ch·ª©c theo d·∫°ng Document, tr√°i ng∆∞·ª£c v·ªõi d·∫°ng b·∫£ng b√™n tr√™n.  *V√≠ d·ª•: MongoDB, Redis* 

## Relational Database
Row ~ Record

Primary key ~ ID: d√πng ƒë·ªÉ ph√¢n bi·ªát c√°c record v·ªõi nhau

SQL - Structure Query Language: quy ƒë·ªãnh quy t·∫Øc, c√∫ ph√°p ƒë·ªÉ user vi·∫øt c√°c l·ªánh nh·∫±m t∆∞∆°ng t√°c, giao ti·∫øp v·ªõi database. 

> SQL ƒëu·ªçc t√≠nh l√† ng√¥n ng·ªØ l·∫≠p tr√¨nh, thu·ªôc nh√≥m *Scripting language* üëâ t·ª©c l√† b·∫£n th√¢n n√≥ s·∫Ω c·∫ßn ƒë·∫øn tr√¨nh th√¥ng d·ªãch Interpreter 

## Base Command

### Database
+ T·∫°o m·ªõi: CREATE DATABASE _nameDatabase; 
+ Xo√°: DROP DATABASE _nameDatabase;
+ S·ª≠a: ALTER DATABASE _nameDatabase;  
```SQL
#list 
postgres=# \l

#describe table  
postgres=# \dt

#change to other DB (c: connect)      
postgres=# \c database2
You are now connected to database "database2" as user "postgres"
database2=#

#change name of DB
postgres=# ALTER DATABASE database2 RENAME TO database3; 

#delete DB
postgres=# DROP DATABASE database3;
```

### Table 
Name of database: DB1
```SQL
#describe table (list of relations)
DB1=# \dt

#structure of table (c√≥ c·ªôt n√†o, r√†ng bu·ªôc g√¨, key ntn?)
DB1=# \d idols
or
DB1=# SELECT * FROM idols;
```
#### Interacting with table (Query tool) üòà SQL command
```SQL
üî¥#thay ƒë·ªïi DATA c·ªßa Table
#createTable
CREATE TABLE idols(
    id integer NOT NULL PRIMARY KEY,
    name text NOT NULL,
    age integer,
    nb_of_movies integer DEFAULT 1
)

#deleteTale
DROP TABLE idols;

#insertData INSERT INTO _nameTable(_nameColums) VALUES(_values)
INSERT INTO idols(name, id, age) VALUES('QuangHai', 19, 24)

#many record together
INSERT INTO idols(name, id, age) 
VALUES      ('QuangHai', 19, 24),
            ('CongPhung', 10, 26),
            ('Ronalsi', 7, 66)

#readData SELECT _nameColum FROM _nameTable [_clauses]
#th·ª±c ch·∫•t ch·ªâ SELECT m·ªõi ƒë∆∞·ª£c coi l√† d·∫°ng l·ªánh Query (Query trong SQL), c√≤n l·∫°i l√† l·ªánh bt. SELECT kh√¥ng ch·ªâ ƒë∆∞·ª£c d√πng ƒë·ªÉ ƒë·ªçc d·ªØ li·ªáu t·ª´ Table m√† c√≤n ƒë·ªçc c√°c gi√° tr·ªã ƒë∆°n l·∫ª, gi·ªëng v·ªõi print, echo.
SELECT * FROM idols         //FROM c≈©ng l√† m·ªánh ƒë·ªÅ
SELECT id, name FROM idols

#ƒë·ªïi t√™n c·ªôt khi hi·ªÉn th·ªã
SELECT id AS i, name AS n FROM idols

#ƒë·ªçc gi√° tr·ªã ƒë∆°n 
SELECT 1 + 2 AS tong, name FROM idols

#updateTable (set&delete)
UPDATE idols SET nb_of_movies = 50, age = 29 WHERE id = 3       //WHERE clause th√¨ ‚ùóph·∫£i ch·ªçn PRIMARY KEY‚ùó

DELETE FROM idols WHERE id = 3

üî¥#thay ƒë·ªïi STRUCTURE c·ªßa Table (t√™n colume, data type,...)
ALTER TABLE idols
ADD COLUMN birthday DATE NOT NULL DEFAULT '2000-01-01',          // g·ªçi l√† 1 action
ADD COLUMN gender BOOL

ALTER TABLE idols
RENAME COLUMN gender TO sex     //rename Colums
RENAME TO idol                  //rename Table


ALTER TABLE idols
DROP COLUMN sex
```

## Data Type
> cast the exression: √©p ki·ªÉu 
+ integer (INT)
+ numeric (DECIMAL)
+ serial - t·ª± ƒë·ªông tƒÉng d·∫ßn gi√° tr·ªã (STT, ID)   //b·∫£n ch·∫•t l√† ki·ªÉu Integer
```SQL
ALTER TABLE idols ADD COLUMN weight DECIMAL
```
+ boolean 
+ character (s·ª≠ d·ª•ng khi mu·ªën gi·ªõi h·∫°n s·ªë l∆∞·ª£ng k√Ω t·ª± cho data) >< Text (Unlimitted - v√≠ d·ª• v·ªÅ 1 ƒëo·∫°n vƒÉn b·∫£n, ti·ªÉu s·ª≠ c√° nh√¢n,...)
+ date (Y-M-D) - c√°ch vi·∫øt ph·ªï bi·∫øn, ti√™u chu·∫©n qu·ªëc t·∫ø ISO 8601
+ time with time zone /without time zone
+ date range
+ interval

## Operation + Expression
To√°n h·∫°ng c√≥ th·ªÉ l√† 1 trong 3 tr∆∞·ªùng h·ª£p: **gi√° tr·ªã ƒë∆°n, Column, 1 l·ªánh SQL kh√°c**
```SQL
SELECT 1 + id FROM idols                //gt ƒë∆°n + Column
SELECT id + age FROM idols              //Column + Column
SELECT EXISTS (SELECT * FROM idols)     //EXISTS l√† to√°n t·ª≠ d·∫°ng Keyword, to√°n h·∫°ng c·ªßa n√≥ l√† 1 c√¢u l·ªánh SQL kh√°c üÜò Keyword ~ Function üëâ EXISTS d√πng ƒë·ªÉ kt xem c√¢u l·ªánh ƒë√≥ c√≥ tr·∫£ v·ªÅ gi√° tr·ªã g√¨ hay l√† kh√¥ng?

#to√°n t·ª≠ BETWEEN th∆∞·ªùng ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ filter
SELECT name FROM idols WHERE age NOT BETWEEN 24 AND 29
```
Ph√©p to√°n so s√°nh ƒë·∫∑c bi·ªát d√†nh cho nh·ªØng gi√° tr·ªã ƒë·∫∑c bi·ªát kh√¥ng th·ªÉ so s√°nh ƒë∆∞·ª£c. V·ªã d·ª•, c·∫ßn so s√°nh gt ƒë·ªÉ bi·∫øt gi√° tr·ªã c√≥ ƒëang **r·ªóng
** hay kh√¥ng
```SQL
‚ùåSELECT name, age FROM idols WHERE nb_movies != NULL‚ùå

üëá

SELECT name, age FROM idols WHERE nb_movies IS NOT NULL
#v·∫≠y n√™n != ch·ªâ ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ so s√°nh v·ªõi c√°c gi√° tr·ªã c·ª• th·ªÉ
```
L√†m vi·ªác v·ªõi chu·ªói k√Ω t·ª±
```SQL
#ƒë·ªô d√†i chu·ªói üîë To√°n t·ª≠ d∆∞·ªõi d·∫°ng Function
SELECT LENGTH('Kim Khuong Duy')

#n·ªëi chu·ªói
SELECT 'Kim Khuong Duy' || '1997'       //concatenate
SELECT 'Kim Khuong Duy' || 1997         //text + int
SELECT name || age FROM idols           //column + column

#t√°ch chu·ªói
SELECT SUBSTRING('Kim Khuong Duy', _startIndex, _sumChar)
#‚õî‚õî‚õîSQL ƒë√°nh s·ªë t·ª´ 1 ch·ª© kh√¥ng ph·∫£i t·ª´ 0‚õî‚õî‚õî

#so s√°nh chu·ªói LIKE (LIKE t∆∞∆°ng ƒë∆∞∆°ng v·ªõi to√°n t·ª≠ ~~)
LIKE: ~~
NOT LIKE: !~~

#with a Template
SELECT 'abcd' LIKE 'a___'       //text LIKE template
SELECT 'abcdf12344' LIKE 'ab%'       //k√Ω t·ª± '%' ƒë·∫°i di·ªán cho to√†n b·ªô nh·ªØng k√Ω t·ª± c√≤n l·∫°i, kh√¥ng c·∫ßn ph·∫£i d√πng ƒë·ªß s·ªë l∆∞·ª£ng k√Ω t·ª± d·∫•u '_'
SELECT 'abcdf12344' LIKE '%cd%'
SELECT 'abcdf12344' LIKE '%44'
SELECT 'abcdf12344' LIKE '%cd%44'
```
Aggregation - g·ªôp
```SQL
SELECT MIN(age) FROM idols
SELECT MAX(age) FROM idols
SELECT SUM(age) FROM idols
SELECT AVG(age) FROM idols
SELECT COUNT(age) FROM idols
```
## Query data with Clause
üëâ Clause d√πng ƒë·ªÉ b·ªï sung th√™m c√°c ƒëi·ªÅu ki·ªán r√†ng bu·ªôc cho c√¢u l·ªánh truy v·∫•n 
```SQL
SELECT * FROM idols
WHERE age BETWEEN 26 AND 29

SELECT * FROM idols
WHERE working               //data type of 'working' is boolean  

UPDATE idols SET age = 28
WHERE id = 3
```
üëâ **GROUP BY** d√πng ƒë·ªÉ nh√≥m c√°c b·∫£n ghi c√≥ d·ªØ li·ªáu tr√πng nhau ·ªü m·ªôt c·ªôt n√†o ƒë√≥
```SQL
SELECT name FROM view_count GROUP BY name
SELECT date FROM view_count GROUP BY date
```
Ô∏èü•ä L∆∞u √Ω: v√≠ d·ª• b√™n tr√™n l√† nh√≥m c√°i n√†o th√¨ select theo c√°i ƒë√≥. Trong tr∆∞·ªùng h·ª£p nh√≥m theo 1 c·ªôt nh∆∞ng l·∫°i select theo c·ªôt kh√°c th√¨ nh·ªØng gi√° tr·ªã kh√¥ng ch·∫≠p ƒë∆∞·ª£c (nh·ªØng gi√° tr·ªã n·∫±m ngo√†i m·ªánh ƒë·ªÅ GROUP BY) th√¨ ph·∫£i ƒë∆∞a ch√∫ng v√†o to√°n t·ª≠ G·ªôp - Aggregation
```SQL
SELECT name, SUM(view_count) FROM view_count GROUP BY name
```
üëâ K·∫øt h·ª£p v·ªõi **WHERE**
```SQL
SELECT name, SUM(view_count) 
FROM view_count 
WHERE date > '2022-01-01'
GROUP BY name
```
üëâ M·ªánh ƒë·ªÅ **HAVING** d√πng ƒë·ªÉ b·ªï tr·ª£ cho GROUP BY (ƒëi sau GROUP BY). Ho·∫°t ƒë·ªông g·∫ßn gi·ªëng v·ªõi WHERE. ƒêi·ªÉm kh√°c bi·ªát ·ªü ch·ªó: WHERE d√πng ƒë·ªÉ l·ªçc d·ªØ li·ªáu t·ª´ table trong DB, c√≤n HAVING l·ªçc d·ªØ li·ªáu k·∫øt qu·∫£ sau khi ƒë√£ g·ªôp row b·∫±ng GROUP BY. 
```SQL
SELECT name, SUM(view_count) 
FROM view_count 
GROUP BY name
HAVING SUM(view_count) > 5       //ƒëi sau HAVING s·∫Ω l√† m·ªôt ƒëi·ªÅu ki·ªán

SELECT date, AVG(view_count) 
FROM view_count 
GROUP BY date
HAVING AVG(view_count) <= 3      //ƒëi sau HAVING s·∫Ω l√† m·ªôt ƒëi·ªÅu ki·ªán
```
üëâ S·∫Øp x·∫øp d·ªØ li·ªáu trong Table b·∫±ng **ORDER BY**
+ ASC: Ascending - tƒÉng d·∫ßn

+ DESC: Descending - gi·∫£m d·∫ßn
```SQL
#n·∫øu kh√¥ng ƒë·ªÉ m·ªánh ƒë·ªÅ ORDER BY th√¨ m·∫∑c ƒë·ªãnh s·∫Ω l√† s·∫Øp x·∫øp theo th·ª© t·ª± tƒÉng d·∫ßn c·ªßa PRIMARY KEY
SELECT * FROM idols

#gi·∫£m d·∫ßn
SELECT * FROM idols
ORDER BY age DESC
```
> üî¥ **ORDER BY** ƒëi sau **GROUP BY**, **GROUP BY** ƒëi sau **WHERE** 

üëâ M·ªánh ƒë·ªÅ **LIMIT** d√πng ƒë·ªÉ gi·ªõi h·∫°n s·ªë row m√† ch√∫ng ta truy v·∫•n ra t·ª´ table
```SQL
#ph·∫£i ƒë·∫∑t sau WHERE, GROUP BY, ORDER BY,... gi·ªëng nh∆∞ ki·ªÉu l√† b∆∞·ªõc l·ªçc cu·ªëi c√πng
SELECT * FROM idols LIMIT 3
```

## R√†ng bu·ªôc - CONSTRAINT
L√† nh·ªØng quy t·∫Øc, rules m√† ch√∫ng ta t·∫°o ra ƒë·ªÉ √°p ƒë·∫∑t l√™n data (data ·ªü ƒë√¢y c√≥ th·ªÉ l√† c·∫£ Table, ho·∫∑c t·ª´ng Columns)

Ô∏èü•ä M·ª•c ƒë√≠ch l√† ƒë·ªÉ tr√°nh ƒë∆∞·ª£c nh·ªØng d·ªØ li·ªáu kh√¥ng h·ª£p l·ªá ƒë∆∞·ª£c nh·∫≠p v√†o DB
> h·∫°n ch·∫ø thay ƒë·ªïi CONSTRAINT tr√™n 1 table ƒë√£ c√≥ v√¨ c√≥ th·ªÉ s·∫Ω g√¢y l·ªói v·ªõi nh·ªØng d·ªØ li·ªáu c≈©, v·∫≠y n√™n c·∫ßn thi·∫øt k·∫ø th·∫≠t chu·∫©n x√°c tr∆∞·ªõc khi b·∫Øt ƒë·∫ßu tri·ªÉn khai.

Li·ªát k√™ c√°c CONSTRAINT v√†o ngay ƒë·∫±ng sau data type
```SQL
#thi·∫øt l·∫≠p CONSTRAINT v√†o sau data type (int)
CREATE TABLE movies (
    id INT NOT NULL,
    title TEXT
)

#xo√° CONSTRAINT
ALTER TABLE movies
ALTER COLUMN title DROP NOT NULL

#b·ªï sung CONSTRAINT cho COLUMN ƒë√£ c√≥
ALTER TABLE movies
ALTER COLUMN title SET NOT NULL
```
üëâ **UNIQUE** ƒë∆∞·ª£c √°p ƒë·∫∑t cho c√°c Columns, v√† n√≥ s·∫Ω quy ƒë·ªãnh cho c√°c d·ªØ li·ªáu trong Columns ƒë√≥ kh√¥ng ƒë∆∞·ª£c ph√©p tr√πng nhau 
```SQL
CREATE TABLE movies (
    id INT PRIMARY KEY,
    title TEXT NOT NULL UNIQUE
)
```
üëâ **PRIMARY KEY** l√† m·ªôt CONSTRAINT r·∫•t quan tr·ªçng, b·∫Øt bu·ªôc ph·∫£i thi·∫øt l·∫≠p khi t·∫°o Table. N√≥ ƒë·∫£m b·∫£o t√≠nh duy nh·∫•t c·ªßa c√°c record (row) c√≥ trong DB 

üÜò M·ªói m·ªôt Table ƒë·ªÅu ph·∫£i c√≥ **PRIMARY KEY**. Kh√° gi·ªëng v·ªõi UNIQUE, nh∆∞ng UNIQUE l√† √°p tr√™n 1 column, c√≤n PRIMARY KEY th√¨ ƒë·∫£m b·∫£o t√≠nh duy nh·∫•t c·ªßa c√°c Rows v·ªõi nhau v√† √°p d·ª•ng cho to√†n Table.
> C√≥ th·ªÉ thi·∫øt l·∫≠p nhi·ªÅu PRIMARY KEY cho m·ªôt Table, nh∆∞ng th√¥ng th∆∞·ªùng ch·ªâ n√™n ch·ªçn duy nh·∫•t 1 c√°i
```SQL
CREATE TABLE movies (
    id INT PRIMARY KEY,         //PRIMARY KEY ~ NOT NULL + UNIQUE
    title TEXT NOT NULL UNIQUE
)
```
üëâ **FOREIGN KEY** ƒë∆∞·ª£c √°p ƒë·∫∑t cho m·ªôt column, c√≥ quy ƒë·ªãnh t√≠nh UNIQUE v√† ƒë·ªìng th·ªùi quy ƒë·ªãnh r·∫±ng: *column n√†y ch·ªâ ƒë∆∞·ª£c ph√©p ch·ª©a PRIMARY KEY c·ªßa m·ªôt Table kh√°c.* 

Gi·ªØa nh·ªØng Table c√≥ li√™n quan ƒë·∫øn nhau th√¨ ch√∫ng c√≥ th·ªÉ l∆∞u KEY c·ªßa nhau, b·∫£ng n√†y l∆∞u KEY c·ªßa b·∫£ng kia.
```SQL
CREATE TABLE movies (
    id INT PRIMARY KEY,
    title TEXT,
    idol_id INT REFERENCES idols(id)        //_nameColumn INT REFERENCES _nameTable(PRIMARY KEY)
)
```
üëâ **CHECK** √°p ƒë·∫∑t cho Column ƒë·ªÉ ƒë·∫£m b·∫£o d·ªØ li·ªáu c·ªßa n√≥ ph·∫£i tho·∫£ m√£n m·ªôt bi·ªÉu th·ª©c LOGIC n√†o ƒë·∫•y. 
```SQL
CREATE TABLE movies (
    id INT PRIMARY KEY,
    title TEXT CHECK (LENGTH(title) >= 5),
    idol_id INT REFERENCES idols(id)  
)
```

> NOTE: T√™n c·ªßa Column b·∫£n ch·∫•t nh∆∞ t√™n c·ªßa Bi·∫øn, Column ~ Bi·∫øn, gi√° tr·ªã thay ƒë·ªïi theo c√°c Row